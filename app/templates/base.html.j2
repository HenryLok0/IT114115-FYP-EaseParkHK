{% extends 'bootstrap/base.html' %}

{% block styles %}
    {{ super() }}
    <style>
    /* Additional night mode styles for specific components */
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }
    
    /* Table styles for dark mode */
    body.dark-mode .table {
      color: #e0e0e0;
      background-color: transparent;
    }
    
    body.dark-mode .table-striped > tbody > tr:nth-of-type(odd) {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    body.dark-mode .table-hover > tbody > tr:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    body.dark-mode .table > thead > tr > th {
      border-bottom: 2px solid #444;
      color: #e0e0e0;
    }
    
    body.dark-mode .table > tbody > tr > td,
    body.dark-mode .table > tbody > tr > th,
    body.dark-mode .table > tfoot > tr > td,
    body.dark-mode .table > tfoot > tr > th,
    body.dark-mode .table > thead > tr > td {
      border-top: 1px solid #444;
    }
    
    body.dark-mode .thead-dark th {
      background-color: #2a2a2a !important;
      color: #e0e0e0 !important;
      border-color: #444 !important;
    }
    
    /* Pagination styles for dark mode */
    body.dark-mode .pagination > li > a,
    body.dark-mode .pagination > li > span {
      background-color: #2a2a2a;
      border-color: #444;
      color: #e0e0e0;
    }
    
    body.dark-mode .pagination > li > a:hover {
      background-color: #3a3a3a;
      border-color: #555;
      color: #ffffff;
    }
    
    body.dark-mode .pagination > .active > a,
    body.dark-mode .pagination > .active > span,
    body.dark-mode .pagination > .active > a:hover,
    body.dark-mode .pagination > .active > span:hover {
      background-color: #375a72;
      border-color: #375a72;
      color: #ffffff;
    }
    
    body.dark-mode .pagination > .disabled > span,
    body.dark-mode .pagination > .disabled > a {
      background-color: #222;
      border-color: #444;
      color: #777;
    }
    
    /* Form control styles for dark mode */
    body.dark-mode .form-control {
      background-color: #2a2a2a;
      border-color: #444;
      color: #e0e0e0;
    }
    
    body.dark-mode .form-control:focus {
      border-color: #66afe9;
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6);
    }
    
    body.dark-mode label {
      color: #e0e0e0;
    }
    
    /* Modal styles for dark mode */
    body.dark-mode .modal-content {
      background-color: #1e1e1e;
      border-color: #444;
      color: #e0e0e0;
    }
    
    body.dark-mode .modal-header {
      border-color: #444;
    }
    
    body.dark-mode .modal-body {
      color: #e0e0e0;
    }
    
    body.dark-mode .close {
      color: #e0e0e0;
      text-shadow: 0 1px 0 #000;
    }
    
    body.dark-mode .modal-header .close {
      color: #e0e0e0;
    }
    
    body.dark-mode .close:hover {
      color: #fff;
    }
    
    /* Button styles for dark mode */
    body.dark-mode .btn-default {
      background-color: #2a2a2a;
      border-color: #444;
      color: #e0e0e0;
    }
    
    body.dark-mode .btn-default:hover {
      background-color: #3a3a3a;
      border-color: #555;
      color: #ffffff;
    }
    
    body.dark-mode .btn-primary {
      background-color: #375a72;
      border-color: #2e4b60;
    }
    
    body.dark-mode .btn-primary:hover {
      background-color: #446b86;
      border-color: #375a72;
    }
    
    body.dark-mode .btn-info {
      background-color: #2d6987;
      border-color: #265a74;
    }
    
    body.dark-mode .btn-info:hover {
      background-color: #357a9e;
      border-color: #2d6987;
    }
    
    body.dark-mode .btn-warning {
      background-color: #8a6d3b;
      border-color: #785f33;
    }
    
    body.dark-mode .btn-warning:hover {
      background-color: #9d7e45;
      border-color: #8a6d3b;
    }
    
    body.dark-mode .btn-danger {
      background-color: #843534;
      border-color: #742e2d;
    }
    
    body.dark-mode .btn-danger:hover {
      background-color: #953b3a;
      border-color: #843534;
    }
    
    /* Panel and well styles for dark mode */
    body.dark-mode .panel,
    body.dark-mode .well {
      background-color: #1e1e1e;
      border-color: #444;
    }
    
    body.dark-mode .panel-default > .panel-heading {
      background-color: #2a2a2a;
      border-color: #444;
      color: #e0e0e0;
    }
    
    body.dark-mode .panel-footer {
      background-color: #2a2a2a;
      border-color: #444;
    }
    
    /* Alert styles for dark mode */
    body.dark-mode .alert-info {
      background-color: #2d4b60;
      border-color: #375a72;
      color: #e0e0e0;
    }
    
    body.dark-mode .alert-success {
      background-color: #2d4d3a;
      border-color: #375a46;
      color: #e0e0e0;
    }
    
    body.dark-mode .alert-warning {
      background-color: #5e512d;
      border-color: #6e6037;
      color: #e0e0e0;
    }
    
    body.dark-mode .alert-danger {
      background-color: #5e2d2d;
      border-color: #6e3737;
      color: #e0e0e0;
    }
    
    /* Dropdown menu styles for dark mode */
    body.dark-mode .dropdown-menu {
      background-color: #1e1e1e;
      border-color: #444;
    }
    
    body.dark-mode .dropdown-menu > li > a {
      color: #e0e0e0;
    }
    
    body.dark-mode .dropdown-menu > li > a:hover,
    body.dark-mode .dropdown-menu > li > a:focus {
      background-color: #375a72;
      color: #fff;
    }
    
    body.dark-mode .dropdown-menu .divider {
      background-color: #444;
    }
    
    /* List group styles for dark mode */
    body.dark-mode .list-group {
      background-color: #1e1e1e;
      border-color: #444;
    }

    body.dark-mode .list-group-item {
      background-color: #2a2a2a;
      color: #e0e0e0;
      border-color: #444;
    }

    body.dark-mode .list-group-item:hover {
      background-color: #3a3a3a;
      color: #ffffff;
    }
    
    body.dark-mode .list-group-item.active,
    body.dark-mode .list-group-item.active:hover,
    body.dark-mode .list-group-item.active:focus {
      background-color: #375a72;
      border-color: #375a72;
      color: #fff;
    }
    
    /* Chatbox styles for dark mode */
    body.dark-mode .chatbox-popup {
      background-color: #1e1e1e;
      border-color: #444;
      color: #e0e0e0;
    }
    
    body.dark-mode .chatbox-header {
      background-color: #375a72;
      border-color: #2e4b60;
    }
    
    /* Sort icons for tables */
    body.dark-mode .sort-icon {
      color: #e0e0e0;
    }
    
    /* Special styling for maps in dark mode */
    body.dark-mode iframe {
      filter: invert(0%);
    }
    
    body.dark-mode #map {
      filter: invert(90%) hue-rotate(180deg);
    }
    
    /* Make the carpark details more readable in dark mode */
    body.dark-mode #carpark-name,
    body.dark-mode #carpark-address,
    body.dark-mode #carpark-status,
    body.dark-mode #carpark-vacancy {
      color: #e0e0e0;
    }
    
    /* Card styles for dark mode if present in the site */
    body.dark-mode .card {
      background-color: #1e1e1e;
      border-color: #444;
    }
    
    body.dark-mode .card-header {
      background-color: #2a2a2a;
      border-color: #444;
    }
    
    body.dark-mode .card-footer {
      background-color: #2a2a2a;
      border-color: #444;
    }
    
    /* Fix for any code blocks or pre elements */
    body.dark-mode pre,
    body.dark-mode code {
      background-color: #2a2a2a;
      border-color: #444;
      color: #e0e0e0;
    }
    
    /* Fix navbar styles for consistency */
    body.dark-mode .navbar-default {
      background-color: #1e1e1e;
      border-color: #444;
    }
    
    body.dark-mode .navbar-default .navbar-nav > li > a,
    body.dark-mode .navbar-default .navbar-brand {
      color: #e0e0e0;
    }
    
    body.dark-mode .navbar-default .navbar-nav > .open > a,
    body.dark-mode .navbar-default .navbar-nav > .open > a:hover,
    body.dark-mode .navbar-default .navbar-nav > .open > a:focus,
    body.dark-mode .navbar-default .navbar-nav > li > a:hover,
    body.dark-mode .navbar-default .navbar-nav > li > a:focus {
      background-color: #2a2a2a;
      color: #fff;
    }

    /* Add these specific styles to your existing dark mode CSS in base.html.j2 */
    body.dark-mode select.form-control {
        background-color: #2a2a2a;
        color: #e0e0e0;
        border-color: #444;
    }

    body.dark-mode select.form-control option {
        background-color: #2a2a2a;
        color: #e0e0e0;
    }

    /* For Firefox which handles select elements differently */
    body.dark-mode select.form-control:focus {
        box-shadow: 0 0 0 0.2rem rgba(55, 90, 114, 0.25);
    }

    /* Make sure dropdown arrows are visible in dark mode */
    body.dark-mode select.form-control::-ms-expand {
        color: #e0e0e0;
    }
    </style>
{% endblock %}

{% block title %}
    {% if title %}
        {{ title }} - EaseParkHK
    {% else %}
        {{ _('EaseParkHK') }}
    {% endif %}
{% endblock %}
{% block navbar %}
    <div class="row">
        <nav class="navbar navbar-default">
            <div class="container">
                <div class="navbar-header">
                    <!-- Add a brand or toggle button if necessary -->
                </div>
                
                {% include "indexbase.html.j2" %}
                {% include "search_bar.html.j2" %}
            </div>
        </nav>
    </div>
    <div class="container">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}<div class="alert alert-info" role="alert">{{ message }}</div>{% endfor %}
            {% endif %}
        {% endwith %}
        {% block app_content %}{% endblock %}
    </div>
{% endblock %}
{% block scripts %}
    {{ super() }}
    {{ moment.include_moment() }}
    {{ moment.lang(g.locale) }}
    
    <script>
        // Ensure night mode is applied across the entire site
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                
                // Special handling for maps if they exist
                const maps = document.querySelectorAll('iframe[src*="maps.google"], iframe[src*="google.com/maps"]');
                maps.forEach(map => {
                    // Add a class to specifically style map iframes
                    map.classList.add('map-iframe');
                });
            }
        });

        // Add this function to your existing JavaScript in base.html.j2
        function updateFormElementsForDarkMode(isDarkMode) {
            const formControls = document.querySelectorAll('select.form-control, input.form-control, textarea.form-control');
            formControls.forEach(element => {
                if (isDarkMode) {
                    element.style.backgroundColor = '#2a2a2a';
                    element.style.color = '#e0e0e0';
                    element.style.borderColor = '#444';
                } else {
                    element.style.backgroundColor = '';
                    element.style.color = '';
                    element.style.borderColor = '';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
            }
        });
    </script>
{% endblock %}